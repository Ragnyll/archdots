#!/bin/bash

# num displays includes laptop display
NUM_DISPLAYS="$(xrandr -q | grep " connected" | wc -l)"
LAPTOP_DISPLAY="eDP-1"
CENTER_DISPLAY="DP-1"
RIGHT_DISPLAY="DP-0"

function one_display() {
	bspc monitor $LAPTOP_DISPLAY -d $LAPTOP_DISPLAY/1 $LAPTOP_DISPLAY/2 $LAPTOP_DISPLAY/3 $LAPTOP_DISPLAY/4 $LAPTOP_DISPLAY/5

    bspc rule -a lightcord desktop='^3'
}

function two_displays() {
	# assume that if two displays are connected then the external is connected through DP1 and is to the right
	xrandr --output $CENTER_DISPLAY --auto --right-of $LAPTOP_DISPLAY

	bspc monitor $CENTER_DISPLAY -d $CENTER_DISPLAY/1 $CENTER_DISPLAY/2 $CENTER_DISPLAY/3 $CENTER_DISPLAY/4 $CENTER_DISPLAY/5
	bspc monitor $LAPTOP_DISPLAY -d $LAPTOP_DISPLAY/6 $LAPTOP_DISPLAY/7 $LAPTOP_DISPLAY/8 $LAPTOP_DISPLAY/9 $CENTER_DISPLAY/10
}

function three_displays() {
	xrandr --output $CENTER_DISPLAY --auto --right-of $LAPTOP_DISPLAY
	xrandr --output $RIGHT_DISPLAY --auto --right-of $CENTER_DISPLAY --rotate right

	bspc monitor $CENTER_DISPLAY -d $CENTER_DISPLAY/1 $CENTER_DISPLAY/2 $CENTER_DISPLAY/3 $CENTER_DISPLAY/4
	bspc monitor $LAPTOP_DISPLAY -d $LAPTOP_DISPLAY/5 $LAPTOP_DISPLAY/6 $LAPTOP_DISPLAY/7 $LAPTOP_DISPLAY/8
	bspc monitor $RIGHT_DISPLAY -d $RIGHT_DISPLAY/9 $RIGHT_DISPLAY/10
}

# the external display only works when the nvidia graphics card is turned on.
# when nvidia graphics is on the LAPTOP_DISPLAY NAME changes
# if the intel card is in use then i should be saving battery. start powertop
[ $(optimus-manager --status | grep 'Current GPU mode : nvidia' | wc -l )  -eq '1' ] \
    && LAPTOP_DISPLAY="eDP-1-1" \
    || sudo powertop --auto-tune

case $NUM_DISPLAYS in
# laptop display left - horizantal monitor center
    "2")
        two_displays
        ;;
# laptop display left - horizantal monitor center - vertial monitor right
    "3")
        three_displays
        ;;
    *)
        # if the NUM_DISPLAYS is undetermined default to 1
        one_display
        ;;
esac

sxhkd &
~/bin/wal_setter.sh $(head -n 1 ~/.config/wallpaper)
dunst &
compton &
~/.config/polybar/launch.sh &
# conky -d
bspc config border_width         2
bspc config window_gap          12
bspc config split_ratio          0.52
bspc config borderless_monocle   true
bspc config gapless_monocle      true
bspc config click_to_focus       true

setxkbmap -option ctrl:swapcaps

clipmenud &
